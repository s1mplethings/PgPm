# PgPm 项目管理应用 - 使用指南

## ✅ 已修复的问题

### 1. Tauri v2 配置更新
- ✅ 更新了 `tauri.conf.json` 到 v2 格式
- ✅ 添加了必要的 `identifier` 字段
- ✅ 修正了配置结构（从 `package` 和 `tauri` 改为扁平结构）

### 2. Rust 代码兼容性
- ✅ 导入了 `tauri::Manager` trait
- ✅ 更新了 `app_data_dir()` 函数以使用 v2 API: `app.path().app_data_dir()`
- ✅ 修复了 `app.manage()` 方法调用

### 3. 文件系统权限
- ✅ Tauri v2 中自定义命令默认有文件访问权限
- ✅ 数据存储路径：`%APPDATA%/pm-app/` (Windows)

---

## 🚀 如何使用

### 开发模式（热重载）

```powershell
# 1. 安装依赖（首次运行或更新后）
pnpm install

# 2. 启动开发服务器
pnpm tauri dev
```

这会：
- 启动 Vite 前端开发服务器（http://localhost:5173）
- 编译 Rust 后端
- 打开桌面应用窗口
- 支持热重载（修改代码自动刷新）

### 构建生产版本

```powershell
# 构建可执行文件
pnpm tauri build
```

输出位置：`src-tauri/target/release/`

---

## 📁 数据存储位置

应用数据存储在：
- **Windows**: `C:\Users\<你的用户名>\AppData\Roaming\pm-app\`
- **macOS**: `~/Library/Application Support/pm-app/`
- **Linux**: `~/.local/share/pm-app/`

### 存储的文件：
- `tasks.json` - 任务列表
- `settings.json` - 应用设置
- `events.json` - 操作日志
- `backups/` - 每次保存时的备份文件

---

## 🎯 功能说明

### 1. 推荐系统
应用会根据以下规则推荐下一个任务：
- **24小时内到期的任务** 自动优先
- **优先级** (P0 > P1 > P2)
- **紧急程度** (距离 due 时间越近越紧急)
- **容量匹配** (工时 ≤16h 最佳)
- **预算余量** (成本 ≤50 最佳)

### 2. 工作模式
在 `settings.json` 中可配置：
- `rule` - 综合评分模式（默认）
- `deadline` - 优先处理快到期的任务
- `cost` - 优先处理低成本任务

### 3. WIP 限制
- 默认每人同时只能处理 1 个任务
- 可在设置中修改 `hard_limits.wip_per_owner`

---

## 🛠️ 常见问题

### Q1: 应用启动失败
**解决方案**:
1. 确保已安装 [Rust](https://www.rust-lang.org/)
2. 确保已安装 [Node.js 18+](https://nodejs.org/)
3. 确保已安装 [pnpm](https://pnpm.io/): `npm install -g pnpm`
4. 删除 `node_modules` 和 `src-tauri/target`，重新运行 `pnpm install`

### Q2: 数据没有保存
**检查**:
- 打开开发者工具（F12）查看控制台错误
- 检查数据文件位置（见上方"数据存储位置"）
- 确认文件系统有写入权限

### Q3: 首次启动看不到任务
这是正常的！应用会使用演示数据初始化：
1. 点击"接受并开始"来处理推荐的任务
2. 任务状态会保存到本地 JSON 文件
3. 下次启动会加载保存的数据

---

## 📝 下一步开发建议

### 短期目标
1. ✅ 修复启动问题（已完成）
2. 🔲 添加任务编辑界面（新增/修改/删除）
3. 🔲 修复状态持久化（接受任务后自动更新状态）
4. 🔲 改进 active 任务管理逻辑

### 中期目标
1. 🔲 添加任务拖拽排序
2. 🔲 添加计时器功能
3. 🔲 改进推荐算法（考虑 owner、依赖关系）
4. 🔲 添加数据导入/导出功能

### 长期目标
1. 🔲 团队协作功能
2. 🔲 数据可视化面板
3. 🔲 自定义工作流
4. 🔲 与外部工具集成（GitHub、Jira等）

---

## 🐛 调试技巧

### 查看应用日志
开发模式下，终端会显示：
- Rust 后端日志
- Vite 前端日志
- 编译错误信息

### 查看前端日志
在应用窗口按 `F12` 打开开发者工具。

### 清空数据重新开始
删除数据目录（见上方"数据存储位置"），应用会重新初始化演示数据。

---

## 💡 提示

- 修改 `src/core/sampleData.ts` 可以更改演示数据
- 修改 `src-tauri/src/commands.rs` 可以调整默认配置
- 热重载只适用于前端代码，修改 Rust 代码需要重启应用

---

**祝使用愉快！** 🎉
